language: node_js

before_install:
  - npm install -g npm
  - npm --version || echo npm not installed
  - node --version || echo node not installed
  - echo "package version $PACKAGE_VERSION"

stages:
  - build
  - test
  - pages
  - release

jobs:
  include:
    # Job: Build
    - stage: build
      node_js:
        - 'lts/*'
        - '10'
        - '8'
      script:
        - npm run build

    # Job: Storybooks
    - stage: pages
      before_script:
        - travis_retry npm install
      node_js:
        - 'lts/*'
        - '10'
        - '8'
      deploy:
        provider: script
        skip_cleanup: true
        script:
          - npm run build-storybook

    # Job: Test
    - stage: test
      node_js:
        - 'lts/*'
        - '10'
        - '8'
      script:
        - npm run test

    # Job: Release
    - stage: release
      script: ls
      node_js: lts/*
      deploy:
        provider: script
        skip_cleanup: true
        script:
          - npx semantic-release